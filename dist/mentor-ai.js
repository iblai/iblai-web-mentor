!function(){"use strict";class t extends HTMLElement{isEmbeddedMentorReady=!1;iblData=new URL(window.location.href).searchParams.get("ibl-data");constructor(){super(),this.attachShadow({mode:"open"});if(this.shadowRoot.innerHTML='\n    <style>\n        iframe {\n        border: 0px white;\n        height: 100%;\n        width: 100%;\n        border-radius: 0;\n        }\n        #ibl-chat-widget-container {\n            border: 1px solid #dfdfdf;\n            width: 400px;\n            height: 96%;\n            right: 15px;\n        }\n        @media screen and (max-width: 768px) {\n        #ibl-chat-widget-container {\n            width: 90% !important;\n            max-width: 400px !important;\n            right: 20px !important;\n        }\n        img.ibl-chat-bubble {\n            right: 20px !important;\n        }\n        }\n    </style>\n    <div id="ibl-chat-widget-container">\n        <iframe\n        allow="clipboard-read; clipboard-write"\n        ></iframe>\n    </div>\n        ',this.iblData){const t=new URL(window.location);t.searchParams.delete("ibl-data"),window.history.replaceState({},document.title,t);const e=JSON.parse(this.iblData).userData;document.cookie=`userData=${e}; domain=${document.domain}; path=/;`}window.addEventListener("message",(t=>{let e=t.data;if("string"==typeof e)try{e=JSON.parse(e)}catch(t){return}if(!this.isAnonymous){if(e?.loaded&&e?.auth?.axd_token){!(document.cookie.includes("userData=")?document.cookie.split("userData=")[1].split(";")[0]:null)&&this.redirectToAuthSPA(!0)}if(!e?.loaded||e.auth.axd_token&&e.auth.dm_token&&e.auth.tenant===embedTenant&&!this.isTokenExpired(e.auth.dm_token_expires)&&!this.isTokenExpired(e.auth.axd_token_expires)||!this.iblData&&this.redirectToAuthSPA(),e?.loaded&&e.auth.userData){const t=document.cookie.includes("userData=")?document.cookie.split("userData=")[1].split(";")[0]:null;if(t)try{JSON.parse(t).user_id!==JSON.parse(e.auth.userData).user_id&&this.iblData&&this.sendAuthDataToIframe(this.iblData)}catch(t){console.error("Error parsing userData cookie:",t)}}}e?.authExpired?this.isAnonymous||this.redirectToAuthSPA(!0):e?.ready&&(this.isEmbeddedMentorReady=!0,this.iblData?this.sendAuthDataToIframe(this.iblData):this.isAnonymous||this.redirectToAuthSPA()),e?.loaded&&this.isContextAware&&this.sendHostInfoToIframe()}))}get mentorUrl(){return this.getAttribute("mentorurl")||"https://mentor.iblai.app"}set mentorUrl(t){this.setAttribute("mentorurl",t)}get tenant(){return this.getAttribute("tenant")}set tenant(t){this.setAttribute("tenant",t)}get mentor(){return this.getAttribute("mentor")}set mentor(t){this.setAttribute("mentor",t)}get isAnonymous(){return this.hasAttribute("isanonymous")}set isAnonymous(t){t?this.setAttribute("isanonymous",""):this.removeAttribute("isanonymous")}get isAdvanced(){return this.hasAttribute("isadvanced")}set isAdvanced(t){t?this.setAttribute("isadvanced",""):this.removeAttribute("isadvanced")}get isContextAware(){return this.hasAttribute("iscontextaware")}set isContextAware(t){t?this.setAttribute("iscontextaware",""):this.removeAttribute("iscontextaware")}get redirectToken(){return this.hasAttribute("redirecttoken")}set redirectToken(t){t?this.setAttribute("redirecttoken",""):this.removeAttribute("redirecttoken")}static get observedAttributes(){return["mentorUrl","tenant","mentor","isadvanced","iscontextaware"]}attributeChangedCallback(t,e,n){if(["mentorUrl","tenant","mentor","isadvanced"].includes(t)&&(this.shadowRoot.querySelector("iframe").src=`${this.mentorUrl}/platform/${this.tenant}/${this.mentor}?embed=true&mode=anonymous&extra-body-classes=iframed-externally${this.isAdvanced?"&chat=advanced":""}`),this.isContextAware){let t=window.location.href;setInterval((()=>{const e=window.location.href;e!==t&&(t=e,this.isEmbeddedMentorReady&&this.sendHostInfoToIframe())}),1e3)}}getCleanBodyContent(){const t=document.body.cloneNode(!0);["script","style","nav","footer",".ads",".sidebar",".popup",".cookie-banner","#ibl-chat-widget-container",".ibl-chat-bubble"].forEach((e=>{t.querySelectorAll(e).forEach((t=>t.remove()))}));const e=t=>{for(let n=0;n<t.childNodes.length;n++){const i=t.childNodes[n];8===i.nodeType?(t.removeChild(i),n--):1===i.nodeType&&e(i)}};return e(t),t.innerHTML}sendHostInfoToIframe(){const t=this.shadowRoot.querySelector("#ibl-chat-widget-container iframe");if(t&&t.contentWindow){const e=this.getCleanBodyContent(),n={reason:"CONTEXT",hostInfo:{title:document.title,href:window.location.href},pageContent:e};t.contentWindow.postMessage(n,"*")}}sendAuthDataToIframe(t){const e=document.querySelector("#ibl-chat-widget-container iframe");e&&e.contentWindow&&e.contentWindow.postMessage(t,"*")}isTokenExpired(t){const e=new Date(t);return new Date>=e}redirectToAuthSPA(t){const e=window.location.pathname+window.location.search;window.location.href=`https://auth.iblai.app/login?redirect-path=${e}&tenant=${this.tenant}${t?"&logout=true":""}&redirectToken=${this.redirectToken}`}toggleWidget(){const t=document.getElementById("ibl-chat-widget-container");"none"===t.style.display?t.style.display="":t.style.display="none"}}customElements.define("mentor-ai",t)}();
//# sourceMappingURL=mentor-ai.js.map
